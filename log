-- =====================================================
--  NOSALT CLIENT LOGGER (FULL VERSION)
-- =====================================================

-- ===== HTTP CHECK =====
local http = request or http_request or syn.request
if not http then
    warn("[nosalt] Executor has no http support")
    return
end

-- ===== SERVICES =====
local Players = game:GetService("Players")
local HttpService = game:GetService("HttpService")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer

-- ===== CONFIG =====
local API_URL = "https://nosalt-log.dusfaaq.repl.co/apilog"
local HEARTBEAT_INTERVAL = 5
local LOG_INTERVAL = 10

-- ===== IDENTITIES =====
local PC_NAME = tostring(getgenv().PC_NAME or "PC_DEFAULT")
local PC_ID = tostring(game.JobId)
local CLIENT_ID = tostring(player.UserId) .. "_" .. math.random(1000,9999)

-- ===== STATE =====
local lastSeed = 0
local lastSend = 0

-- ===== SAFE NUMBER =====
local function toNumber(v)
    if not v then return 0 end
    local s = tostring(v):gsub(",", "")
    local n = tonumber(s)
    if not n then return 0 end
    return n
end

-- ===== SEND LOG =====
local function sendLog(message, seed)
    http({
        Url = API_URL,
        Method = "POST",
        Headers = {
            ["Content-Type"] = "application/json"
        },
        Body = HttpService:JSONEncode({
            pc_id = PC_ID,
            pc_name = PC_NAME,
            client = CLIENT_ID,
            seed = seed or lastSeed,
            message = message
        })
    })
end

-- ===== SEED DETECTION =====
local function getSeed()
    local stats = player:FindFirstChild("leaderstats")
    if not stats then return lastSeed end

    for _,v in pairs(stats:GetChildren()) do
        if v.Name:lower():find("seed") then
            return toNumber(v.Value)
        end
    end

    return lastSeed
end

-- ===== STILL ALIVE =====
task.spawn(function()
    while true do
        sendLog("Still Alive", lastSeed)
        task.wait(HEARTBEAT_INTERVAL)
    end
end)

-- ===== MAIN LOOP =====
task.spawn(function()
    while true do
        local seed = getSeed()
        if seed ~= lastSeed then
            lastSeed = seed
            sendLog("Seed Update", seed)
        end
        task.wait(LOG_INTERVAL)
    end
end)

-- ===== INIT =====
sendLog("Connected | PC: "..PC_NAME.." | Client: "..CLIENT_ID, 0)

-- ===== HEARTBEAT =====
RunService.Heartbeat:Connect(function()
    if tick() - lastSend > 30 then
        sendLog("Heartbeat Sync", lastSeed)
        lastSend = tick()
    end
end)

-- =====================================================
--  END
-- =====================================================